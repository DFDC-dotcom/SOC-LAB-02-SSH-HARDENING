Este laboratÃ³rio simula um cenÃ¡rio de comprometimento de integridade num sistema Linux atravÃ©s da manipulaÃ§Ã£o do ficheiro crÃ­tico /etc/passwd, criando um utilizador com privilÃ©gios equivalentes a root (UID 0).

O objetivo Ã© validar:
Capacidade de deteÃ§Ã£o com File Integrity Monitoring (FIM)
ClassificaÃ§Ã£o de severidade
AnÃ¡lise tÃ©cnica do impacto
Mapeamento para ISO 27001 e NIST
ImplementaÃ§Ã£o de medidas corretivas e preventivas

ğŸ§± Lab Environment
Componente	DescriÃ§Ã£o
Sistema Operativo	Ubuntu 24.04 LTS
MonitorizaÃ§Ã£o	AIDE
Logging adicional	auditd
Recursos VM	2GB RAM
ğŸ¯ Scenario

Foi introduzida manualmente a seguinte entrada no ficheiro /etc/passwd:
evil:x:0:0:evil:/root:/bin/bash


Isto cria:
Novo utilizador
UID 0 (equivalente a root)
PersistÃªncia privilegiada

ğŸ” Detection Phase
1ï¸âƒ£ VerificaÃ§Ã£o de integridade
sudo aide --config /etc/aide/aide.conf --check

Resultado observado
AlteraÃ§Ã£o detetada em /etc/passwd
MudanÃ§a nas seguintes hashes:
MD5
SHA1
SHA256
SHA512
AlteraÃ§Ã£o de timestamps (mtime / ctime)

InterpretaÃ§Ã£o TÃ©cnica

Qualquer alteraÃ§Ã£o no conteÃºdo do ficheiro altera todas as funÃ§Ãµes de hash.
Isto confirma modificaÃ§Ã£o real do conteÃºdo e nÃ£o apenas alteraÃ§Ã£o de metadata.

ğŸ§ª Investigation Steps
VerificaÃ§Ã£o de mÃºltiplos UID 0
grep ":0:" /etc/passwd


Resultado:
root
evil

VerificaÃ§Ã£o de atividade
last
grep evil /var/log/auth.log


Objetivo:
Identificar login bem-sucedido
Correlacionar com timestamps do ficheiro

Timeline bÃ¡sica
stat /etc/passwd


AnÃ¡lise de:
Modify time
Change time

ğŸ“Š Risk Assessment
CritÃ©rio	AvaliaÃ§Ã£o
Integridade	Comprometida
PrivilÃ©gios	EscalaÃ§Ã£o para root
PersistÃªncia	Sim
Impacto potencial	Total controlo do host
Severidade	ğŸ”´ Critical

JustificaÃ§Ã£o: AlteraÃ§Ã£o de controlo de identidade privilegiada.

ğŸ“š Control Framework Mapping
ISO 27001:2022

A.5.15 â€“ Access Control
A.5.16 â€“ Identity Management
A.8.15 â€“ Logging
A.8.16 â€“ Monitoring Activities

NIST SP 800-53
AC-2 â€“ Account Management
AC-6 â€“ Least Privilege
SI-7 â€“ Integrity Monitoring
AU-6 â€“ Audit Review

ğŸ›¡ï¸ Remediation Actions

RemoÃ§Ã£o do utilizador malicioso
RestauraÃ§Ã£o do ficheiro original
AtualizaÃ§Ã£o da baseline AIDE

ImplementaÃ§Ã£o de regra auditd:
sudo auditctl -w /etc/passwd -p wa -k passwd_changes

ProteÃ§Ã£o adicional:
sudo chattr +i /etc/passwd
