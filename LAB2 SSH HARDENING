# SOC Lab #2 – SSH Hardening & Baseline Security (Ubuntu Server)

## Overview

This lab demonstrates the implementation of secure configuration controls on an Ubuntu Server to reduce SSH attack surface and align with defensive security best practices.

The objective was to simulate a real-world hardening process, validate security controls, and document the impact from a Blue Team perspective.

---

## Lab Architecture

- Attacker Machine: Kali Linux
- Target / SOC Machine: Ubuntu Server
- Virtualization: VirtualBox
- Network Segmentation:
  - NAT (Internet access)
  - Host-Only (Isolated attack simulation network)
---

## Initial Baseline (Before Hardening)

- SSH running on default port 22 
- Password authentication enabled
- Root login potentially allowed
- No firewall restrictions
- No brute-force protection

Scripts used: sudo systemctl status ssh
sudo nano /etc/ssh/sshd_config
Port 2222
sudo sshd -t
sudo systemctl restart ssh
sudo ss -tulpn | grep ssh
---
IN /etc/ssh/sshd_config on SOC (VM of Defense):
PermitRootLogin - no
PasswordAuthentication no
PubkeyAuthentication yes


IN KALI (Offensive VM)
ssh-keygen -t ed25519 -a 100 -C "soc-lab-key"
ssh-copy-id -p 2222 diogo@192.168.56.X

---
On Ubuntu = SOC 

mkdir -p ~/.ssh
nano ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 2222/tcp
sudo ufw enable
sudo ufw status verbose

FAIL2BAN INSTALL AND CONFIG
sudo apt install fail2ban -y
sudo nano /etc/fail2ban/jail.local
sudo systemctl restart fail2ban
sudo fail2ban-client status sshd

CONFIG:
[sshd]
enabled = true
port = 2222
backend = systemd
maxretry = 3
findtime = 600
bantime = 3600

ATTACK SIMULATIONS:
ssh -p 2222 invaliduser@192.168.56.X at least 3 times 

CHECK ON FAIL2BAN ON UBUNTU
sudo fail2ban-client status sshd

## Hardening Measures Implemented

### 1. SSH Configuration Hardening

- Changed default SSH port (22 → 2222)
- Disabled root login
- Disabled password authentication
- Enabled key-based authentication only
- Limited authentication attempts (MaxAuthTries = 3)
- Restricted allowed users

### 2. SSH Key-Based Authentication

- Generated ED25519 key pair
- Deployed public key to authorized_keys
- Disabled password-based access

### 3. Firewall Configuration (UFW)

- Default deny incoming
- Default allow outgoing
- Explicitly allowed port 2222 only

### 4. Fail2Ban Deployment

- Enabled SSH jail
- Configured maxretry = 3
- Configured bantime = 3600 seconds
- Integrated with UFW for automated blocking

---

## Validation & Testing

### Test 1 – Successful SSH Key Login
Result: Access granted without password.

### Test 2 – Password Authentication Attempt
Result: Access denied.

### Test 3 – Brute-Force Simulation (3+ failures)
Result: Attacker IP automatically banned by Fail2Ban.

### Test 4 – Firewall Inspection
Result: Only port 2222 exposed.

---

## Security Improvements Achieved

| Control | Risk Mitigated |
|----------|---------------|
| Disable root login | Privileged brute-force |
| Non-default SSH port | Automated scanning noise |
| Key-based authentication | Credential brute-force |
| Fail2Ban | Automated incident response |
| UFW restrictions | Attack surface reduction |

---

## CIS Benchmark Alignment (Selected Controls)

- Enforced SSH protocol version 2
- Disabled password authentication
- Restricted user access
- Reduced open network services
- Enforced strong authentication mechanisms

Reference: CIS Ubuntu Linux Benchmark

---

## Lessons Learned

- Network segmentation is critical in lab design.
- Systemd socket activation can override SSH port changes.
- Log monitoring is essential for validating defensive controls.
- Testing is mandatory after every configuration change.

---

## Skills Demonstrated

- Linux server hardening
- SSH secure configuration
- Firewall management
- Brute-force mitigation
- Log analysis
- Incident simulation
- Defensive security mindset

---

## Future Improvements

- Deploy centralized logging
- Integrate with SIEM
- Implement auditd monitoring
- Apply full CIS Level 1 baseline
- Automate configuration using Ansible


---

## Author

Diogo Costa
Aspiring SOC / Cybersecurity Analyst
